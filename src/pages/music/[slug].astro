---
import { getCollection, getEntryBySlug } from "astro:content";
import BaseLayout from "../../layouts/BaseLayout.astro";
import Breadcrumbs from "../../components/Breadcrumbs.astro";
import MarkdownContent from "../../components/MarkdownContent.astro";
import PageFrame from "../../components/PageFrame.astro";
import { SITE_DOMAIN } from "../../lib/constant";

export async function getStaticPaths() {
    const entries = await getCollection("music");
    return entries.map((entry) => ({
        params: { slug: entry.slug },
    }));
}

const { slug } = Astro.params;
const entry = await getEntryBySlug("music", slug);
if (!entry) {
    throw new Error("Not found");
}

const { Content } = await entry.render();
const dateText =
    entry.data.date instanceof Date
        ? entry.data.date.toISOString().slice(0, 10)
        : "";
const crumbs = [
    { label: "~", href: "/" },
    { label: "music", href: "/music" },
    { label: entry.data.title },
];
---

<BaseLayout title={`${entry.data.title} | ${SITE_DOMAIN}`}>
    <PageFrame>
        <Breadcrumbs items={crumbs} />
        <MarkdownContent>
            <Content />
        </MarkdownContent>
    </PageFrame>
</BaseLayout>
