---
import { getCollection } from "astro:content";
import BaseLayout from "../../layouts/BaseLayout.astro";
import Breadcrumbs from "../../components/Breadcrumbs.astro";
import PageFrame from "../../components/PageFrame.astro";
import SearchInput from "../../components/SearchInput.astro";
import SearchFilter from "../../components/SearchFilter.astro";
import TreeList from "../../components/TreeList.astro";
import { SITE_DOMAIN } from "../../lib/constant";
import { buildListing } from "../../lib/tree";
import { SECTIONS } from "../../lib/sections";

export const getStaticPaths = async () => [
  ...SECTIONS.map((section) => ({ params: { section } })),
];

const { section } = Astro.params;
if (!SECTIONS.includes(section)) {
    throw new Error("Not found");
}

const entries = await getCollection(section);
const items = buildListing(entries, `/${section}`);

const crumbs = [
    { label: "~", href: "/" },
    { label: section, href: `/${section}` },
];
---

<BaseLayout title={`${section} | ${SITE_DOMAIN}`}>
    <PageFrame>
        <Breadcrumbs items={crumbs} />
        <SearchInput id="section-search" placeholder="Search titles" />
        <SearchFilter />
        <TreeList items={items} emptyMessage="No markdown yet." showDesc={false} />
    </PageFrame>
</BaseLayout>
