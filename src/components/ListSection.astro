---
const {
  title = "",
  items = [],
  titleHref = "",
  emptyMessage = "No entries.",
  titleFont = "folder",
} = Astro.props;
const hasItems = items.length > 0;
---

<section class="section" data-section>
  <h2 class={titleFont === "inherit" ? "inherit-font" : ""}>
    {titleHref ? <a href={titleHref}>{title}</a> : title}
  </h2>
  <div class="cards">
    {hasItems
      ? items.map((item) => (
          <>
            {item.href ? (
              <a
                href={item.href}
                class="card"
                data-title={item.title}
                target={item.external ? "_blank" : undefined}
                rel={item.external ? "noopener noreferrer" : undefined}
              >
                <div class="item">
                  <span class="bullet" aria-hidden="true">•</span>
                  <div class="text">
                    <div class="title-row">
                      <h3 class="title">
                        <span class="title-text">{item.title}</span>
                      </h3>
                      {item.date ? <span class="date">{item.date}</span> : null}
                    </div>
                    {item.desc ? <p class="muted">{item.desc}</p> : null}
                  </div>
                </div>
              </a>
            ) : (
              <article class="card" data-title={item.title}>
                <div class="item">
                  <span class="bullet" aria-hidden="true">•</span>
                  <div class="text">
                    <div class="title-row">
                      <h3 class="title">
                        <span class="title-text">{item.title}</span>
                      </h3>
                      {item.date ? <span class="date">{item.date}</span> : null}
                    </div>
                    {item.desc ? <p class="muted">{item.desc}</p> : null}
                  </div>
                </div>
              </article>
            )}
            {item.children?.length ? (
              <div class="children">
                {item.children.map((child) =>
                  child.href ? (
                    <a
                      href={child.href}
                      class="card child"
                      data-title={child.title}
                      target={child.external ? "_blank" : undefined}
                      rel={child.external ? "noopener noreferrer" : undefined}
                    >
                      <div class="item">
                        <span class="bullet" aria-hidden="true">•</span>
                        <div class="text">
                          <div class="title-row">
                            <h3 class="title">
                              <span class="title-text">{child.title}</span>
                            </h3>
                            {child.date ? (
                              <span class="date">{child.date}</span>
                            ) : null}
                          </div>
                          {child.desc ? (
                            <p class="muted">{child.desc}</p>
                          ) : null}
                        </div>
                      </div>
                    </a>
                  ) : (
                    <article class="card child" data-title={child.title}>
                      <div class="item">
                        <span class="bullet" aria-hidden="true">•</span>
                        <div class="text">
                          <div class="title-row">
                            <h3 class="title">
                              <span class="title-text">{child.title}</span>
                            </h3>
                            {child.date ? (
                              <span class="date">{child.date}</span>
                            ) : null}
                          </div>
                          {child.desc ? (
                            <p class="muted">{child.desc}</p>
                          ) : null}
                        </div>
                      </div>
                    </article>
                  )
                )}
              </div>
            ) : null}
          </>
        ))
      : null}
    <p class={`empty ${hasItems ? "hidden" : ""}`} data-empty>
      {emptyMessage}
    </p>
  </div>
</section>

<style>
  .section h2 {
    font-size: 18px;
    margin-bottom: 12px;
    font-weight: 400;
    font-family:
      "Helvetica Neue", "Arial", "Hiragino Kaku Gothic ProN", "Hiragino Sans",
      "Yu Gothic", "Meiryo", sans-serif;
  }

  .section h2.inherit-font {
    font-family: inherit;
  }

  .section h2 a {
    color: inherit;
    text-decoration: none;
  }

  .section h2 a:hover {
    text-decoration: underline;
    text-decoration-thickness: 1px;
    text-underline-offset: 2px;
  }

  .cards {
    display: grid;
    gap: 10px;
  }

  .card {
    display: grid;
    gap: 0;
    padding: 8px 0 8px 16px;
    border: none;
    border-radius: 0;
    background: transparent;
    text-decoration: none;
    color: inherit;
  }

    .card h3 {
        font-size: 16px;
        font-weight: 400;
    }

  .card:hover .title-text {
    text-decoration: underline;
    text-decoration-thickness: 1px;
    text-underline-offset: 2px;
  }

  .card.child {
    padding-left: 28px;
  }

  .children {
    display: grid;
  }

  .item {
    display: grid;
    grid-template-columns: 10px 1fr;
    column-gap: 6px;
    align-items: baseline;
  }

  .text {
    display: grid;
    gap: 1px;
  }

  .title-row {
    display: flex;
    align-items: baseline;
    justify-content: space-between;
    gap: 12px;
  }

  .title {
    margin: 0;
  }

  .bullet {
    width: 10px;
    text-align: center;
    line-height: 1;
    margin-top: 2px;
  }

  .muted {
    color: #5b5b5b;
    font-size: 12px;
    margin: 0;
  }

  .date {
    font-size: 12px;
    color: #616161;
    white-space: nowrap;
  }

  .empty {
    color: #6b6b6b;
    font-size: 14px;
  }

  .empty.hidden {
    display: none;
  }
</style>
